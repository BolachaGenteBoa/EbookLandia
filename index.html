<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>EbookLandia - Home</title>
    <style>
        :root { --primary: #38bdf8; --bg: #0f172a; --card: #1e293b; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: white; }

        header {
            background: rgba(30, 41, 59, 0.8); backdrop-filter: blur(10px);
            padding: 15px 5%; position: fixed; top: 0; width: 100%; z-index: 1000;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .logo { font-size: 1.5rem; font-weight: 800; color: var(--primary); }
        .logo span { color: white; }

        .nav-right { display: flex; align-items: center; gap: 20px; }

        .wallet {
            background: #0f172a; padding: 8px 15px; border-radius: 50px;
            border: 1px solid var(--primary); font-weight: bold;
            display: flex; align-items: center; gap: 10px;
        }

        .container { max-width: 1200px; margin: 120px auto 50px; padding: 0 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 30px; }

        .card { background: var(--card); border-radius: 15px; overflow: hidden; transition: 0.3s; border: 1px solid transparent; }
        .card:hover { transform: translateY(-5px); border-color: var(--primary); }
        .card img { width: 100%; height: 350px; object-fit: cover; }
        .card-body { padding: 20px; text-align: center; }
        .price { color: #4ade80; font-size: 1.4rem; font-weight: 800; margin: 10px 0; }

        .btn-buy { background: var(--primary); color: #0f172a; width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        
        /* Barra de Admin */
        .adm-bar { background: #6366f1; padding: 10px 5%; margin-top: 75px; display: none; justify-content: space-between; align-items: center; }

        /* Mensagem de vazio estilizada */
        .empty-msg { grid-column: 1 / -1; text-align: center; padding: 50px; color: var(--primary); font-style: italic; }
    </style>
</head>
<body>

    <header>
        <div class="logo">Ebook<span>Landia</span></div>
        <div class="nav-right">
            <div id="user-display" style="font-size: 0.9rem; font-weight: 500;">Carregando...</div>
            <div class="wallet">Saldo: R$ <span id="saldo-val">0.00</span></div>
            <button id="btnLogout" style="background:none; border:none; color: #ef4444; cursor:pointer; font-weight:bold;">Sair</button>
        </div>
    </header>

    <div id="adm-bar" class="adm-bar">
        <span id="cargo-info"></span>
        <button onclick="alert('Painel em desenvolvimento')" style="background:white; border:none; padding:5px 15px; border-radius:5px; cursor:pointer; font-weight:bold">Painel Equipe</button>
    </div>

    <div class="container">
        <div class="grid" id="vitrine">
            <div class="empty-msg">Nenhum ebook disponível ainda. Seja o primeiro a postar!</div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyATu9zkykXFpiTD2Mlh5Ee6qroDC1tefi8",
            authDomain: "ebooklandia-f041aa.firebaseapp.com",
            projectId: "ebooklandia-f041aa",
            storageBucket: "ebooklandia-f041aa.firebasestorage.app",
            messagingSenderId: "316525003872",
            appId: "1:316525003872:web:5327dac57baabdd3792f05"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Monitor de Autenticação
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                // Pega o nome de usuário do "email" falso
                const username = user.email.split('@')[0];
                document.getElementById("user-display").innerText = "Olá, " + username;
                
                // Busca dados adicionais no Firestore (Saldo/Cargo)
                try {
                    const userDoc = await getDoc(doc(db, "usuarios", user.uid));
                    if (userDoc.exists()) {
                        const data = userDoc.data();
                        document.getElementById("saldo-val").innerText = data.saldo.toFixed(2);
                        if(data.cargo && data.cargo !== "Leitor") {
                            document.getElementById("adm-bar").style.display = "flex";
                            document.getElementById("cargo-info").innerText = "CARGO: " + data.cargo;
                        }
                    }
                } catch (e) {
                    console.log("Perfil ainda não criado no banco de dados.");
                }
                
                renderVitrine();
            } else {
                // Se não tiver logado, expulsa para o login
                window.location.href = "login.html";
            }
        });

        async function renderVitrine() {
            const v = document.getElementById("vitrine");
            try {
                const snap = await getDocs(collection(db, "livros"));
                if(!snap.empty) {
                    v.innerHTML = "";
                    snap.forEach(d => {
                        const l = d.data();
                        v.innerHTML += `
                            <div class="card">
                                <img src="${l.capa || 'https://via.placeholder.com/350x500'}">
                                <div class="card-body">
                                    <h3>${l.titulo}</h3>
                                    <p class="price">R$ ${parseFloat(l.preco).toFixed(2)}</p>
                                    <button class="btn-buy" onclick="alert('Funcionalidade de compra ativa!')">COMPRAR</button>
                                </div>
                            </div>`;
                    });
                }
            } catch (err) {
                console.log("Ainda não existem livros no banco.");
            }
        }

        // Função Sair
        document.getElementById("btnLogout").addEventListener("click", () => {
            signOut(auth).then(() => {
                window.location.href = "login.html";
            });
        });
    </script>
</body>
</html>
